name: Release

on:
  pull_request:
    types:
      - closed

permissions:
  contents: write
  pull-requests: write

jobs:
  release:
    if: >-
      github.event.pull_request.merged &&
      contains(github.event.pull_request.labels.*.name, 'autorelease: pending') &&
      contains(github.event.pull_request.labels.*.name, 'versioning_strategy: default')
    timeout-minutes: 15
    runs-on: ubuntu-24.04
    steps:
      - name: Publish tag and release

        # Temporary fork until following are implemented:
        # – Bump release-please to v17.1.0 or later
        # – Support for replacing only pre-execution version in extra-files
        uses: dsktschy/release-please-action@c135340c5ba36cf42122ea5508f80763d3b2eda2

        with:
          config-file: release-please-config.default.json
          skip-github-pull-request: true
          target-branch: ${{ github.event.pull_request.base.ref }}

  prerelease:
    if: >-
      github.event.pull_request.merged &&
      contains(github.event.pull_request.labels.*.name, 'autorelease: pending') &&
      contains(github.event.pull_request.labels.*.name, 'versioning_strategy: prerelease')
    timeout-minutes: 15
    runs-on: ubuntu-24.04
    steps:
      - name: Publish tag and release

        # Temporary fork until following are implemented:
        # – Bump release-please to v17.1.0 or later
        # – Support for replacing only pre-execution version in extra-files
        uses: dsktschy/release-please-action@c135340c5ba36cf42122ea5508f80763d3b2eda2

        with:
          config-file: release-please-config.prerelease.json
          skip-github-pull-request: true
          target-branch: ${{ github.event.pull_request.base.ref }}
